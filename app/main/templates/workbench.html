{% extends "base.html" %}
{% set active_page = "workbench.html" %}
{% import "bootstrap5/form.html" as wtf %}

{% block title %}{{title}}{% endblock %}

{% block app_content %}
<style>
    .scrollspy-example {
        position: relative;
        /*height: 200px;*/
        overflow: auto;
    }
</style>

{% block scripts %}
    {{ super() }}
    {{ dropzone.load_css() }}
    {{ dropzone.load_js() }}
{% endblock %}

<div class="row"> <!-- col-md-4 col-lg-3 pb-3 -->
    <div class="col">
    <h3 class="text-center pt-2">Upload new files</h3>
        </br>
            <div class="row">
                <!-- DropZone -->
                {{ super() }}
                {{ dropzone.style('border: 5px dashed gray; margin: auto; min-height: 100px; max-width: 700px') }}
                {{ dropzone.create(action=url_for('main.workbench'))}}
            </div>
        </br>
            <div class="text-center">
                <button id="upload" class="btn btn-primary" onclick="document.getElementById('uploader').dropzone.processQueue();">Upload</button>
            </div>
        </br>
            <div class="row">
                <!-- File selection -->
                <div class="col-md-6">
                    <h2>Upload files or folders</h2>
                    <hr>

                    <form id="image-upload-form" method="post" enctype="multipart/form-data" action="{{ url_for('main.workbench') }}">
                        {{ upload_form.hidden_tag() }}

                        {{ upload_form.image_files.label }}
                        {{ upload_form.image_files() }}
                        <br>
                        {{ upload_form.folder_files.label }}

                        {{ upload_form.folder_files }}

                        <button type="submit" class="btn btn-primary mt-3" name="submit" value="Upload">Upload</button>
                    </form>
                </div>
            </div>
        </br>
    </div>

<form method="POST" action={{ url_for('main.workbench') }}>
    <div class="col">
        <!-- Task list Scrollspy -->
        <div id="scrollspy1" style="background-color: #eee" class="sticky-top">
            <ul class="nav flex-column nav-pills menu-sidebar" id="tasks">
                <h3 class="text-center pt-2">Select task</h3>
                {% for task in batch_form.task_name.choices %}
                    <li><input type="radio" name="task_name" value={{task}}> {{task}}</li>
                {% endfor %}
            </ul>
        </br>
            <label for="task_variable">Slice width for SNR measurement (optional):</label>
                <input type="string" name="task_variable"></p>
            {{ batch_form.submit }}
        </div>
    </div>
</div>

</br>

<div class="row"> <!-- col-md-4 col-lg-3 pb-3 -->
    <h3 class="text-center pt-2">Available files</h3></br>
    {% for study in studies %}
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ loop.index }}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">{{ study.uid }}</button>
            </h2>
        </div>
        <div id="collapse{{ loop.index }}" class="accordion-collapse collapse show" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead><tr>
                            <th>Select</th>
                            <th>Series Description</th>
                            <th>Acquisition Date</th>
                            <th>Uploaded Date</th>
                            <th>Uploaded by</th>
                            <!-- <th>Files</th> -->
                            <th>Reports</th>
                            <th>Remove</th>
                        </tr></thead>
                        <tbody>
                            <!-- series is the db query result, essentially a list of series that are not archived -->
                            <!-- acquisition is an instance/row of the Series table -->
    <!-- Rest of the code -->
<!-- acquisition is an instance/row of the Series table -->
{% for study in studies %}
    <!-- Rest of the code -->
    {% for series in study.series %}
        {% for image in series.image %}
            <tr>
                <td><input type="checkbox" name="many_series" value={{series.id}}></td>
                <td>
                    <a href="{{ url_for('main.task_selection', series_id=series.id) }}">{{ image.filename }}</a>
                </td>
                <td>{{ series.series_datetime }}</td>
                <td>{{ series.created_at.format('YYYY-MM-DD HH:mm') }}</td>
                <td>{{ series.user.username }}</td>
                <!-- <td>num files</td> -->
                <td>
                    {% if series.has_report %}
                        <a href="{{ url_for('main.reports', series_id=series.id) }}">report</a>
                    {% else %}
                        None
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('main.delete', series_id=series.id) }}">
                        <img src="../../static/trash.svg">
                    </a>
                </td>
            </tr>
        {% endfor %}
    {% endfor %}
    <!-- Rest of the code -->
{% endfor %}


    <!-- Rest of the code -->


                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
</form>
<!--
    <nav aria-label="...">
        <ul class="pagination justify-content-center">
            <li class="page-item{% if not prev_url %} disabled{% endif %}">
                <a class= "page-link" href="{{ prev_url or '#' }}" tabindex="-1">
                    <span aria-hidden="true">&larr;</span> Newer acquisitions
                </a>
            </li>
            <li class="page-item{% if not next_url %} disabled{% endif %}">
                <a class= "page-link" href="{{ next_url or '#' }}">
                    Older acquisitions <span aria-hidden="true">&rarr;</span>
                </a>
            </li>
        </ul>
    </nav>
-->

{% endblock %}



                <!-- DropZone -
            </br>
        </form>
        <div class="text-center">
            <button id="upload" class="btn btn-primary" onclick="document.getElementById('uploader').dropzone.processQueue();">Upload</button>
        </div>
        </br>
    </div>
</div>

<!-- Rest of your HTML content -->




